<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Forecasting the S&amp;P 500 with a CNN | Nur Nibir Notes</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Newsreader:wght@400;600;700&family=Work+Sans:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="page">
      <header class="topbar">
        <div class="brand">
          <span class="logo">NN</span>
          <span class="name">Nur Nibir</span>
        </div>
        <nav class="nav">
          <a href="index.html#home">home</a>
          <a href="index.html#about">about</a>
          <a href="index.html#tags">tags</a>
        </nav>
        <div class="social">
          <a href="https://github.com/nurnibir123" aria-label="GitHub">
            <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
              <path
                d="M12 2C6.48 2 2 6.58 2 12.23c0 4.5 2.87 8.32 6.84 9.67.5.1.68-.22.68-.49 0-.24-.01-.89-.01-1.74-2.78.62-3.37-1.37-3.37-1.37-.46-1.2-1.12-1.52-1.12-1.52-.91-.64.07-.63.07-.63 1.01.07 1.54 1.06 1.54 1.06.9 1.59 2.36 1.13 2.94.86.09-.67.35-1.13.63-1.39-2.22-.26-4.56-1.14-4.56-5.06 0-1.12.39-2.03 1.03-2.75-.1-.26-.45-1.3.1-2.71 0 0 .84-.27 2.75 1.05.8-.23 1.66-.34 2.52-.34.86 0 1.72.12 2.52.34 1.91-1.32 2.75-1.05 2.75-1.05.55 1.41.2 2.45.1 2.71.64.72 1.03 1.63 1.03 2.75 0 3.93-2.34 4.79-4.58 5.05.36.32.68.94.68 1.9 0 1.37-.01 2.47-.01 2.81 0 .27.18.59.69.49A10.02 10.02 0 0 0 22 12.23C22 6.58 17.52 2 12 2z"
              />
            </svg>
          </a>
          <a href="https://linkedin.com/in/nur-nibir" aria-label="LinkedIn">
            <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
              <path
                d="M20.44 2H3.56C2.7 2 2 2.7 2 3.56v16.88C2 21.3 2.7 22 3.56 22h16.88c.86 0 1.56-.7 1.56-1.56V3.56C22 2.7 21.3 2 20.44 2zM8.28 18.46H5.71V9.9h2.57v8.56zM7 8.72a1.49 1.49 0 1 1 0-2.98 1.49 1.49 0 0 1 0 2.98zm11.48 9.74h-2.57v-4.16c0-.99-.02-2.26-1.38-2.26-1.38 0-1.59 1.08-1.59 2.19v4.23h-2.57V9.9h2.47v1.17h.04c.34-.64 1.18-1.31 2.43-1.31 2.6 0 3.08 1.73 3.08 3.97v4.73z"
              />
            </svg>
          </a>
        </div>
      </header>

      <section class="post-hero">
        <p class="eyebrow">January 22, 2026 Â· Machine learning research</p>
        <h1>Forecasting the S&amp;P 500 with a CNN: From Research Paper to Real Data</h1>
        <p class="lede">
          A practical case study in turning market history into a signal, training a
          1D CNN, and evaluating the results on real S&amp;P 500 data. Source code for this experiment can be found <a href="https://github.com/nurnibir123/spx-cnn/blob/main/spx_cnn.ipynb">here</a>
        </p>
        <div class="post-callout disclaimer">
          <p>
            <strong>Disclaimer:</strong> This is educational content, not financial
            advice. Forecasting market prices is uncertain and can lead to rapid
            losses in real trading.
          </p>
        </div>
      </section>

      <main class="post">
        <h2>Why I built this</h2>
        <p>
          I have always been interested in financial forecasting, not as a crystal
          ball, but as an engineering challenge. A research paper on using CNNs for
          market time-series data (S&P 500 Stock's Movement Prediction using CNN by Rahul Gupta) sparked the idea: treat price history like a signal
          and let a convolutional model learn repeating patterns over time.
        </p>
        <p>
          CNNs are usually associated with images, but they are powerful on sequences
          too. That was enough to build a real version using the dataset I had on
          hand: historical S&amp;P 500 index data.
        </p>

        <h2>What I wanted to predict</h2>
        <p>I targeted two horizons to separate short-term and longer-term dynamics:</p>
        <ul>
          <li><strong>T+5 trading days:</strong> near-term momentum and volatility.</li>
          <li><strong>T+30 trading days:</strong> longer trend and macro drift.</li>
        </ul>

        <h2>Dataset: S&amp;P 500 historical daily data</h2>
        <p>
          The dataset includes daily OHLC values (open, high, low, close) plus percent
          change. I merged an older archive with a newer update, removed duplicates,
          and sorted everything chronologically to prevent leakage.
        </p>

        <h2>Turning price history into model inputs</h2>
        <p>
          Instead of feeding single days, I built sliding windows so each training
          sample contains the last 60 trading days. The model predicts returns, not
          absolute price.
        </p>
        <div class="equation-card">
          <p class="equation-title">Windowing</p>
          <p class="equation-line">
            <span class="math">X<sub>t</sub> = [t-59, ..., t]</span>
          </p>
          <p class="equation-line">
            <span class="math">y<sub>t+5</sub> = (P<sub>t+5</sub> - P<sub>t</sub>) / P<sub>t</sub></span>
          </p>
          <p class="equation-line">
            <span class="math">y<sub>t+30</sub> = (P<sub>t+30</sub> - P<sub>t</sub>) / P<sub>t</sub></span>
          </p>
          <p class="equation-line equation-meta">
            <span class="math">Input shape: (60, 8) | Targets: (samples, 2)</span>
          </p>
        </div>
        <figure class="post-figure">
          <svg class="diagram" viewBox="0 0 640 190" role="img" aria-labelledby="windowTitle windowDesc">
            <title id="windowTitle">Sliding window input</title>
            <desc id="windowDesc">A 60 day window feeds the CNN and targets future returns.</desc>
            <rect x="40" y="70" width="360" height="60" class="window-box" />
            <rect x="420" y="70" width="80" height="60" class="window-box" />
            <rect x="510" y="70" width="80" height="60" class="window-box" />
            <rect x="60" y="90" width="320" height="20" class="window-slice" />
            <path d="M400 100 L420 100" class="window-arrow" />
            <path d="M500 100 L510 100" class="window-arrow" />
            <text x="70" y="60" class="axis-label">60-day input window</text>
            <text x="432" y="60" class="axis-label">T+5</text>
            <text x="520" y="60" class="axis-label">T+30</text>
          </svg>
          <figcaption>
            Each sample includes the last 60 sessions and predicts returns 5 and 30
            days ahead.
          </figcaption>
        </figure>
        <h3>Why predict returns instead of price?</h3>
        <p>
          Predicting raw price can make training unstable because price levels drift
          over decades. Returns are more stationary, so the model focuses on relative
          movement instead of absolute magnitude.
        </p>
        <div class="equation-card">
          <p class="equation-title">Return to price reconstruction</p>
          <p class="equation-line">
            <span class="math">P_hat<sub>t+h</sub> = P<sub>t</sub> * (1 + r_hat<sub>t+h</sub>)</span>
          </p>
        </div>

        <h2>Feature engineering (small changes, big impact)</h2>
        <p>
          The paper used a richer feature set, but I expanded the available data with
          derived signals that capture volatility and candle structure.
        </p>
        <div class="post-grid">
          <div class="info-card">
            <h3>HL_range</h3>
            <p>Daily range relative to price: <code>(H - L) / P</code></p>
          </div>
          <div class="info-card">
            <h3>OC_change</h3>
            <p>Open to close move: <code>(P - O) / O</code></p>
          </div>
          <div class="info-card">
            <h3>Ret_1d</h3>
            <p>Daily return: <code>(P_t - P_t-1) / P_t-1</code></p>
          </div>
        </div>
        <p>
          Final channels: Open, High, Low, Close, Change %, HL_range, OC_change,
          Ret_1d. The CNN treats those channels like a multi-band signal.
        </p>

        <h2>Normalization and target scaling</h2>
        <p>
          To keep the learning stable and avoid data leakage, I normalized inputs and
          constrained targets in a separate step.
        </p>
        <ul>
          <li>StandardScaler fit on training windows only.</li>
          <li>Train and test windows transformed with the same scaler.</li>
          <li>Return bounds computed from the 1% and 99% training quantiles.</li>
          <li>Targets scaled into [-1, 1] and mapped through tanh output.</li>
        </ul>

        <h2>Why CNNs work here</h2>
        <p>
          CNNs can learn repeating patterns inside a time window. Markets are noisy,
          but local structures do repeat: momentum bursts, volatility compression,
          and short-term mean reversion. A 1D CNN can learn those patterns without the
          training cost of a recurrent model.
        </p>

        <h2>Model architecture</h2>
        <p>
          The model is a 1D CNN regressor with convolution blocks, batch normalization,
          LeakyReLU activations, global average pooling, and dense layers for the
          two outputs.
        </p>
        <h3>Exact layer stack</h3>
        <figure class="post-figure stack-figure">
          <svg class="diagram stack-diagram" viewBox="0 0 640 580" role="img" aria-labelledby="stackTitle stackDesc">
            <title id="stackTitle">CNN layer stack</title>
            <desc id="stackDesc">Exact CNN layers used for the forecasting model.</desc>
            <defs>
              <marker id="stackArrow" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto">
                <path d="M0,0 L8,4 L0,8 Z" class="stack-arrow-head" />
              </marker>
            </defs>
            <rect x="90" y="24" width="460" height="30" class="stack-box accent" />
            <text x="320" y="44" class="stack-label">Input (60 x 8)</text>
            <line x1="320" y1="54" x2="320" y2="68" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="74" width="460" height="30" class="stack-box" />
            <text x="320" y="94" class="stack-label">Conv1D 64 + BN + LeakyReLU</text>
            <line x1="320" y1="104" x2="320" y2="118" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="124" width="460" height="30" class="stack-box" />
            <text x="320" y="144" class="stack-label">Conv1D 64 + BN + LeakyReLU</text>
            <line x1="320" y1="154" x2="320" y2="168" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="174" width="460" height="30" class="stack-box" />
            <text x="320" y="194" class="stack-label">MaxPooling1D (2)</text>
            <line x1="320" y1="204" x2="320" y2="218" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="224" width="460" height="30" class="stack-box" />
            <text x="320" y="244" class="stack-label">Conv1D 128 + BN + LeakyReLU</text>
            <line x1="320" y1="254" x2="320" y2="268" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="274" width="460" height="30" class="stack-box" />
            <text x="320" y="294" class="stack-label">Conv1D 128 + BN + LeakyReLU</text>
            <line x1="320" y1="304" x2="320" y2="318" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="324" width="460" height="30" class="stack-box" />
            <text x="320" y="344" class="stack-label">GlobalAveragePooling1D</text>
            <line x1="320" y1="354" x2="320" y2="368" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="374" width="460" height="30" class="stack-box" />
            <text x="320" y="394" class="stack-label">Dropout 0.25</text>
            <line x1="320" y1="404" x2="320" y2="418" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="424" width="460" height="30" class="stack-box" />
            <text x="320" y="444" class="stack-label">Dense 128 + BN + LeakyReLU</text>
            <line x1="320" y1="454" x2="320" y2="468" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="474" width="460" height="30" class="stack-box" />
            <text x="320" y="494" class="stack-label">Dropout 0.25</text>
            <line x1="320" y1="504" x2="320" y2="518" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="524" width="460" height="30" class="stack-box accent" />
            <text x="320" y="544" class="stack-label">Dense 2 + tanh</text>
          </svg>
          <figcaption>
            Exact layer stack from the input window to the bounded two-horizon outputs.
          </figcaption>
        </figure>
        <div class="post-callout">
          <h3>Output constraints</h3>
          <ul>
            <li>Return targets are scaled into [-1, 1].</li>
            <li>Tanh activation keeps predictions bounded.</li>
            <li>Outputs are rescaled back into return space per horizon.</li>
          </ul>
        </div>

        <h2>Training setup</h2>
        <ul>
          <li>Time split: first 80% train, last 20% test.</li>
          <li>Optimizer: Adam with learning rate 5e-4.</li>
          <li>Loss: Huber (delta = 0.05) to reduce outlier impact.</li>
          <li>Batch size 256, max epochs 60.</li>
          <li>EarlyStopping (val_loss, patience 6, restore best weights).</li>
          <li>ReduceLROnPlateau (val_loss, factor 0.5, patience 3, min_lr 1e-5).</li>
        </ul>

        <h2>Results and model performance</h2>
        <p>
          I evaluated forecasts in price space by reconstructing predicted prices from
          the return outputs. The short-term horizon tracked the market more closely
          than the long-term horizon, which is expected in noisy markets.
        </p>
        <div class="metric-grid">
          <div class="metric-card">
            <h3>T+5 RMSE</h3>
            <p class="metric-value">117.65</p>
            <p class="metric-sub">T+5 MAE: 86.64</p>
          </div>
          <div class="metric-card">
            <h3>T+30 RMSE</h3>
            <p class="metric-value">266.83</p>
            <p class="metric-sub">T+30 MAE: 217.94</p>
          </div>
        </div>

        <div class="plot-grid">
          <div class="plot-card">
            <h3>T+5 Forecast Plot</h3>
            <svg class="plot-chart" viewBox="0 0 320 160" role="img" aria-labelledby="plot5Title plot5Desc">
              <title id="plot5Title">Actual vs predicted T+5</title>
              <desc id="plot5Desc">Two lines show actual and predicted prices.</desc>
              <line x1="30" y1="130" x2="300" y2="130" class="plot-axis" />
              <line x1="30" y1="30" x2="30" y2="130" class="plot-axis" />
              <path d="M30 110 C 70 80, 120 100, 170 70 S 260 60, 300 40" class="plot-line" />
              <path d="M30 118 C 80 90, 130 105, 180 82 S 255 75, 300 55" class="plot-line alt" />
            </svg>
            <p class="metric-sub">Short-term predictions stay close to the trend.</p>
          </div>
          <div class="plot-card">
            <h3>T+30 Forecast Plot</h3>
            <svg class="plot-chart" viewBox="0 0 320 160" role="img" aria-labelledby="plot30Title plot30Desc">
              <title id="plot30Title">Actual vs predicted T+30</title>
              <desc id="plot30Desc">Two lines show actual and predicted prices.</desc>
              <line x1="30" y1="130" x2="300" y2="130" class="plot-axis" />
              <line x1="30" y1="30" x2="30" y2="130" class="plot-axis" />
              <path d="M30 100 C 90 70, 140 85, 200 60 S 270 40, 300 55" class="plot-line" />
              <path d="M30 112 C 90 88, 150 95, 210 78 S 270 65, 300 70" class="plot-line alt" />
            </svg>
            <p class="metric-sub">Longer horizons lag and deviate more, as expected.</p>
          </div>
          <div class="plot-card">
            <h3>Training Curve</h3>
            <svg class="plot-chart" viewBox="0 0 320 160" role="img" aria-labelledby="trainTitle trainDesc">
              <title id="trainTitle">Training loss curve</title>
              <desc id="trainDesc">Loss declines and then levels out.</desc>
              <line x1="30" y1="130" x2="300" y2="130" class="plot-axis" />
              <line x1="30" y1="30" x2="30" y2="130" class="plot-axis" />
              <path d="M30 40 C 90 60, 150 90, 220 100 S 280 110, 300 112" class="plot-line" />
            </svg>
            <p class="metric-sub">Huber loss stabilized with early stopping.</p>
          </div>
        </div>

        <h2>Latest model forecast</h2>
        <p>
          Using the most recent 60-day window, the model produced the following
          forecasts:
        </p>
        <div class="metric-grid">
          <div class="metric-card">
            <h3>Latest input</h3>
            <p class="metric-value">2026-01-21</p>
            <p class="metric-sub">Last price: 6875.62</p>
          </div>
          <div class="metric-card">
            <h3>Predicted T+5</h3>
            <p class="metric-value">6944.05</p>
            <p class="metric-sub">Return: +0.995%</p>
          </div>
          <div class="metric-card">
            <h3>Predicted T+30</h3>
            <p class="metric-value">6827.78</p>
            <p class="metric-sub">Return: -0.695%</p>
          </div>
        </div>

        <div class="post-callout">
          <p>
            The takeaway: a small short-term drift higher, followed by mild mean
            reversion over the 30-day horizon. The predictions stay within realistic
            bounds instead of extreme jumps.
          </p>
        </div>

        <h2>What I learned</h2>
        <ul>
          <li>Predicting returns is more stable than predicting absolute price.</li>
          <li>Bounding outputs with tanh prevents unrealistic spikes.</li>
          <li>Feature engineering outperformed simply adding more layers.</li>
          <li>Longer horizons are fundamentally harder to predict.</li>
        </ul>

        <h2>Limitations</h2>
        <ul>
          <li>No macro or news awareness.</li>
          <li>No explicit volatility regime modeling.</li>
          <li>Daily data only, no intraday structure.</li>
          <li>Single-point forecasts, not full paths.</li>
        </ul>

        <h2>Next improvements I want to try</h2>
        <ul>
          <li>Multi-step forecasts for a full 30-day path.</li>
          <li>Technical features like moving averages, RSI, and ATR.</li>
          <li>Transformer and attention-based baselines.</li>
          <li>Walk-forward validation instead of a single split.</li>
          <li>Baseline comparisons with LSTM and XGBoost.</li>
        </ul>

        <h2>Final thoughts</h2>
        <p>
          This project was inspired by research, but the real work was translating the
          idea into a working pipeline on real data. Even though markets are noisy,
          building models like this is a great way to sharpen time-series engineering,
          feature design, and evaluation discipline.
        </p>

        <section class="sources">
          <h3>Sources</h3>
          <ul>
            <li>
              <a href="https://arxiv.org/abs/2512.21804">
                arXiv: 2512.21804
              </a>
            </li>
          </ul>
        </section>
        <p class="post-disclaimer">
          This post is educational only. Trading decisions should be made with
          professional advice and your own risk controls.
        </p>
      </main>

      <footer class="footer">
        <p>Made with curiosity and calm focus.</p>
      </footer>
    </div>
  </body>
</html>
