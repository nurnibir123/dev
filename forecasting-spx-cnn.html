<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Forecasting the Next Trading Day in SPX (Hourly) | Nur Nibir Notes</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Space+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="page">
      <header class="topbar">
        <div class="brand">
          <span class="logo">NN</span>
          <span class="name">Nur Nibir</span>
        </div>
        <nav class="nav">
          <a href="index.html#home">home</a>
          <a href="index.html#about">about</a>
          <a href="index.html#tags">tags</a>
        </nav>
        <div class="social">
          <a href="https://github.com/nurnibir123" aria-label="GitHub">
            <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
              <path
                d="M12 2C6.48 2 2 6.58 2 12.23c0 4.5 2.87 8.32 6.84 9.67.5.1.68-.22.68-.49 0-.24-.01-.89-.01-1.74-2.78.62-3.37-1.37-3.37-1.37-.46-1.2-1.12-1.52-1.12-1.52-.91-.64.07-.63.07-.63 1.01.07 1.54 1.06 1.54 1.06.9 1.59 2.36 1.13 2.94.86.09-.67.35-1.13.63-1.39-2.22-.26-4.56-1.14-4.56-5.06 0-1.12.39-2.03 1.03-2.75-.1-.26-.45-1.3.1-2.71 0 0 .84-.27 2.75 1.05.8-.23 1.66-.34 2.52-.34.86 0 1.72.12 2.52.34 1.91-1.32 2.75-1.05 2.75-1.05.55 1.41.2 2.45.1 2.71.64.72 1.03 1.63 1.03 2.75 0 3.93-2.34 4.79-4.58 5.05.36.32.68.94.68 1.9 0 1.37-.01 2.47-.01 2.81 0 .27.18.59.69.49A10.02 10.02 0 0 0 22 12.23C22 6.58 17.52 2 12 2z"
              />
            </svg>
          </a>
          <a href="https://linkedin.com/in/nur-nibir" aria-label="LinkedIn">
            <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
              <path
                d="M20.44 2H3.56C2.7 2 2 2.7 2 3.56v16.88C2 21.3 2.7 22 3.56 22h16.88c.86 0 1.56-.7 1.56-1.56V3.56C22 2.7 21.3 2 20.44 2zM8.28 18.46H5.71V9.9h2.57v8.56zM7 8.72a1.49 1.49 0 1 1 0-2.98 1.49 1.49 0 0 1 0 2.98zm11.48 9.74h-2.57v-4.16c0-.99-.02-2.26-1.38-2.26-1.38 0-1.59 1.08-1.59 2.19v4.23h-2.57V9.9h2.47v1.17h.04c.34-.64 1.18-1.31 2.43-1.31 2.6 0 3.08 1.73 3.08 3.97v4.73z"
              />
            </svg>
          </a>
        </div>
      </header>

      <section class="post-hero">
        <p class="eyebrow">January 22, 2026 · Machine learning research</p>
        <h1>Forecasting the Next Trading Day in SPX (Hourly) with a Probability CNN</h1>
        <p class="lede">
          A fast, ResNet-style Conv1D that predicts a full distribution of next-day
          moves instead of a single point estimate.
        </p>
        <p class="lede">
          Inspired by Rahul Gupta's research paper, <em>S&P 500 Stock's Movement Prediction using CNN</em>,
          and adapted to the hourly SPX tape. This is a reminder that you don’t need institutional data to have institutional alpha.
        </p>
        <div class="post-callout disclaimer">
          <p>
            <strong>Disclaimer:</strong> This is educational content, not financial
            advice. Market forecasting is uncertain and can lead to rapid losses.
          </p>
        </div>
      </section>

      <main class="post">
        <h2>Why probabilities beat point forecasts</h2>
        <p>
          Single-price forecasts can be misleading. A model can be directionally
          correct while missing magnitude, or land close to the close while being
          wrong about risk. Instead of asking for the exact next candle, I asked a
          more useful question: where is SPX likely to end up after the next seven
          hourly candles, and with what probability?
        </p>

        <h2>What I built</h2>
        <p>
          The model outputs a probability distribution over the next-day move. That
          lets me compute trading-style probabilities like:
        </p>
        <div class="post-callout">
          <ul>
            <li>P(Δ7 ≥ +10 points)</li>
            <li>P(Δ7 ≤ -10 points)</li>
            <li>P(|Δ7| ≤ 10 points)</li>
          </ul>
        </div>
        <p>
          This framing matches how traders think: ranges, probabilities, and risk
          bands rather than a single deterministic close.
        </p>

        <h2>Dataset</h2>
        <p>
          I used hourly SPX OHLC candles. Each row is one hour of open, high, low,
          and close. The model looks back 120 hours (about 3-4 weeks of trading hours)
          and predicts the move over the next 7 hourly candles, which is one full
          trading day. Training data spans May 15, 2019 at 10:30 AM ET through
          January 23, 2026 at 3:30 PM ET.
        </p>

        <h2>Turning forecasting into classification</h2>
        <p>
          Instead of predicting a future close, I predict the future point move after
          seven hours and discretize it into bins.
        </p>
        <div class="equation-card">
          <p class="equation-title">Future move</p>
          <p class="equation-line">
            <span class="math">Δ<sub>7</sub> = Close<sub>t+7</sub> - Close<sub>t</sub></span>
          </p>
          <p class="equation-line">
            <span class="math">BIN_SIZE = 5 | MAX_MOVE = 200</span>
          </p>
          <p class="equation-line equation-meta">
            <span class="math">Bins cover [-200, +200] → 80 total bins</span>
          </p>
        </div>
        <p>
          Each label is a single bin index. The CNN then outputs an 80-bin softmax
          distribution for the next-day move.
        </p>

        <h2>Windowing setup</h2>
        <p>
          WINDOW = 120, HORIZON = 7. Each input is a 120-hour feature matrix.
        </p>
        <div class="equation-card">
          <p class="equation-title">Shapes</p>
          <p class="equation-line">
            <span class="math">X ∈ R<sup>120 x F</sup></span>
          </p>
          <p class="equation-line">
            <span class="math">y ∈ {0, 1, ..., 79}</span>
          </p>
        </div>
        <figure class="post-figure">
          <svg class="diagram" viewBox="0 0 640 190" role="img" aria-labelledby="windowTitle windowDesc">
            <title id="windowTitle">Windowing for probability CNN</title>
            <desc id="windowDesc">A 120-hour window feeds the CNN and targets the next 7-hour move.</desc>
            <rect x="40" y="70" width="420" height="60" class="window-box" />
            <rect x="480" y="70" width="100" height="60" class="window-box" />
            <rect x="60" y="90" width="380" height="20" class="window-slice" />
            <path d="M460 100 L480 100" class="window-arrow" />
            <text x="70" y="60" class="axis-label">120-hour input window</text>
            <text x="502" y="60" class="axis-label">T+7</text>
          </svg>
          <figcaption>
            Each sample uses 120 hours of history to classify the 7-hour move bin.
          </figcaption>
        </figure>

        <h2>Model architecture: fast ResNet-style Conv1D</h2>
        <p>
          A small ResNet-style CNN gave the best balance of accuracy, speed, and
          stability. It is parameter-efficient and trains quickly on hourly candles.
        </p>
        <div class="post-callout">
          <ul>
            <li><strong>Stem:</strong> Conv1D(32, k=5) + BN + LeakyReLU + SpatialDropout</li>
            <li><strong>Residual blocks:</strong> 2x ResBlock(32) → MaxPool → 2x ResBlock(64) → MaxPool → ResBlock(128)</li>
            <li><strong>Head:</strong> GlobalAvgPool → Dense(64) → Dense(80, softmax)</li>
          </ul>
        </div>
        <figure class="post-figure stack-figure">
          <svg class="diagram stack-diagram" viewBox="0 0 640 660" role="img" aria-labelledby="stackTitle stackDesc">
            <title id="stackTitle">ResNet-style Conv1D stack</title>
            <desc id="stackDesc">Stem, residual blocks, pooling, and softmax head.</desc>
            <defs>
              <marker id="stackArrow" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto">
                <path d="M0,0 L8,4 L0,8 Z" class="stack-arrow-head" />
              </marker>
            </defs>
            <rect x="90" y="24" width="460" height="30" class="stack-box accent" />
            <text x="320" y="44" class="stack-label">Input (120 x F)</text>
            <line x1="320" y1="54" x2="320" y2="72" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="84" width="460" height="30" class="stack-box" />
            <text x="320" y="104" class="stack-label">Conv1D 32 + BN + LeakyReLU</text>
            <line x1="320" y1="114" x2="320" y2="132" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="144" width="460" height="30" class="stack-box" />
            <text x="320" y="164" class="stack-label">SpatialDropout1D</text>
            <line x1="320" y1="174" x2="320" y2="192" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="204" width="460" height="30" class="stack-box" />
            <text x="320" y="224" class="stack-label">ResBlock x2 (32)</text>
            <line x1="320" y1="234" x2="320" y2="252" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="264" width="460" height="30" class="stack-box" />
            <text x="320" y="284" class="stack-label">MaxPooling1D</text>
            <line x1="320" y1="294" x2="320" y2="312" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="324" width="460" height="30" class="stack-box" />
            <text x="320" y="344" class="stack-label">ResBlock x2 (64)</text>
            <line x1="320" y1="354" x2="320" y2="372" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="384" width="460" height="30" class="stack-box" />
            <text x="320" y="404" class="stack-label">MaxPooling1D</text>
            <line x1="320" y1="414" x2="320" y2="432" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="444" width="460" height="30" class="stack-box" />
            <text x="320" y="464" class="stack-label">ResBlock x1 (128)</text>
            <line x1="320" y1="474" x2="320" y2="492" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="504" width="460" height="30" class="stack-box" />
            <text x="320" y="524" class="stack-label">GlobalAveragePooling1D</text>
            <line x1="320" y1="534" x2="320" y2="552" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="564" width="460" height="30" class="stack-box" />
            <text x="320" y="584" class="stack-label">Dense 64</text>
            <line x1="320" y1="594" x2="320" y2="612" class="stack-arrow" marker-end="url(#stackArrow)" />

            <rect x="90" y="624" width="460" height="30" class="stack-box accent" />
            <text x="320" y="644" class="stack-label">Dense 80 + softmax</text>
          </svg>
          <figcaption>
            The fast ResNet-style Conv1D produces a probability distribution over 80
            bins for the next-day move.
          </figcaption>
        </figure>

        <h2>Training details</h2>
        <ul>
          <li>Time split: first 80% train, last 20% test.</li>
          <li>StandardScaler fit on training only.</li>
          <li>Batch size 1024, epochs 20 with early stopping.</li>
          <li>Loss: sparse categorical cross entropy.</li>
          <li>Optimizer: Adam (lr = 1e-3).</li>
          <li>Callbacks: EarlyStopping(patience=4), ReduceLROnPlateau(patience=2).</li>
        </ul>

        <h2>Probability map outputs</h2>
        <p>
          The output is a full histogram of likely Δ7 outcomes. From that histogram
          I compute bullish, bearish, and chop-day probabilities. The histogram below
          reflects the latest available data as of January 23, 2026 at 3:30 PM ET.
        </p>
        <figure class="post-figure">
          <img
            class="plot-chart probability-chart"
            src="assets/spx-probability-map.png"
            alt="SPX close at +7 candles probability map histogram"
            loading="lazy"
          />
          <figcaption>
            Histogram output lets you compute directional or range probabilities.
          </figcaption>
        </figure>

        <h2>CNN vs Transformer results</h2>
        <p>
          I tested a Transformer model on the same task. It consistently lagged the
          CNN on short-horizon errors.
        </p>
        <div class="metric-grid">
          <div class="metric-card">
            <h3>CNN errors</h3>
            <p class="metric-value">Step +1 RMSE: 23.0</p>
            <p class="metric-sub">Step +5 RMSE: 51.0</p>
          </div>
          <div class="metric-card">
            <h3>Transformer errors</h3>
            <p class="metric-value">Step +1 RMSE: 24.0</p>
            <p class="metric-sub">Step +5 RMSE: 53.2</p>
          </div>
        </div>

        <h2>Why CNNs won on this dataset</h2>
        <ul>
          <li>CNNs assume local, reusable patterns, which matches candle behavior.</li>
          <li>Transformers need more data to learn locality from scratch.</li>
          <li>CNNs trained faster, so iteration and tuning were more productive.</li>
        </ul>

        <h2>Automating the pipeline (next step)</h2>
        <ol class="step-list">
          <li>Append new hourly candles to the dataset.</li>
          <li>Fine-tune the model on CPU for a few epochs.</li>
          <li>Generate the next-day probability map.</li>
          <li>Publish the histogram and JSON to the site.</li>
        </ol>

        <h2>Final takeaways</h2>
        <ul>
          <li>Predict distributions, not point estimates.</li>
          <li>Small CNNs can outperform larger models on realistic datasets.</li>
          <li>Probability outputs align better with trading decisions.</li>
        </ul>

        <section class="sources">
          <h3>Sources</h3>
          <ul>
            <li>
              <a href="https://arxiv.org/abs/2512.21804">arXiv: 2512.21804</a>
            </li>
          </ul>
        </section>
        <p class="post-disclaimer">
          This post is educational only. Trading decisions should be made with
          professional advice and your own risk controls.
        </p>
      </main>

      <footer class="footer">
        <p>Made with curiosity and calm focus.</p>
      </footer>
    </div>
  </body>
</html>
